---
{"dg-publish":true,"permalink":"/1 数据分析/2 AB实验/0 AB实验 科学归因与增长利器/2 深入 AB 实验/3 AB 实验的统计学知识/","dgPassFrontmatter":true,"noteIcon":"","created":"2023-10-03T07:38:21.176+08:00","updated":"2023-10-04T03:24:33.398+08:00"}
---



![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003125400.png)

# 3.1 随机抽样和抽样分布

1. 依据中心极限定理，即使原始数据分布不是正态的，从中抽取样本后，样本均值的分布也是正态的，我们可以用均值的正态分布来估计置信区间，进而可以进行参数检验（t检验等），来估计两个样本均值之间是否存在差异
2. 两个概念
	1. 样本容量
		1. 每个随机样本里面个体的个数
	2. 样本量
		1. 随机抽样的次数，即样本数
3. 样本容量越大，正态分布的钟形越高，如果样本容量是全体，则分布是一条竖线
	1. 样本容量越大，多个样本计算出来的指标，分布呈正态分布
	2. 人为定义出可以接受的置信区间，可以计算出，需要多大的样本量、样本容量，可以满足需求
4. 标准正态分布概率表，可以查询不同值的累积概率，以此获取区间内的概率

# 3.2 区间估计和置信区间

1. 置信水平 1 - α
	1. 置信区间的面积即为置信水平，这个可以预先人为设定
	2. 如设置置信水平为 95%，则置信区间的面积为 0.95（正态分布整体面积为1）
2. 显著性水平 α
3. 侧面级为 `α/2` 时的Z值，据此可以计算出 边际误差
	1. 边际误差为 要获取满足条件的区间，正态分布中值上下允许的偏差
	2. 正态分布中值上下允许的偏差，即为 置信水平在 1 - α的，取值区间。
		1. 如果计算的是平均值，则总体的平均值有 1-α的概率，在 此区间中
		2. 在 样本容量、标准差不变的情况下，1-α 越大，则边际误差越大

# 3.3 样本容量和边际误差

1. 增加置信水平的两个方法
	1. 增加样本容量 n 来改变分布形状，使钟形更加集中，可以在不增加边际误差的情况下增加置信水平
	2. 增加边际误差，即增加置信区间的宽度，可以在不改变样本容量的情况下，增加置信水平

## 3.3.1 均值类指标

1. 边际误差和样本容量成反比，和方差成正比，和显著性水平成正比
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003133258.png)
2. 样本容量的公式
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003133328.png)
3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003133412.png)
	1. 边际误差，可以根据实际业务需要，进行调整
	2. 边际误差减少为原来的一半时，标准差不变的情况下，样本容量要变成原来的 4倍，是指数级关系
4. 边际误差是业务需要检出的最低变化幅度，所以又称为最小检出水平

> 在应用中，根据实际需要提出边际误差，满足业务需求的情况下，尽量采用较大的误差水平

## 3.3.2 比率类指标

1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003133907.png)
2. 比率类指标的 正态分布中值，在抽样前是未知的，需采用近似值替代，近似值选取方法如下：
	1. 经验值，或较小样本抽取、计算出近似值
	2. 定义为 0.5，在其他任何情况下，样本容量都会比 0.5时需要的样本容量小，因此可以获取样本容量的最大值
		1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003134354.png)



# 3.4 假设检验

## 3.4.1 为什么需要假设检验

1. 在AB实验中，实验组对照组的置信区间，如果是交织在一起的，就很难判断实验是否有效
2. 为了尽量得到一个相对明确且可信的结构，这时需要用到假设检验

## 3.4.2 如何进行假设检验

1. 核心思想：小概率事件在一次实验中几乎不可能发生
2. 基本过程
	1. 做出一个假设 H0，以及它的备择假设 H1 （H0的对立假设）
	2. 在 H0 成立的情况下，根据置信度构造出一个小概率事件
3. 根据抽样的结果，观察小概率事件是否发生
	1. 发生了，我们可以拒绝假设H0，接受 H1
	2. 没有发生，不能拒绝 H0
		1. 此时不等于接受 H0，只是说差异还不够显著到可以拒绝 H0的程度
4. 关键点：小概率事件的界定
	1. 主要取决于实际的业务场景，可以理解为能容忍犯第一类错误的概率，即通常所说的显著性水平
	2. 显著性水平是人为定义出来的概率值，和实际实验观察是没有关系的
		1. 5%比较常见
5. 显著性水平 α
	1. 人为定义的，用于判断是否为小概率事件的阈值，如果低于阈值，则认为是小概率事件，也是可以接受判断发生错误的概率
6. P值
	1. 小概率事件实际发生的概率，如果 P < α，则认为小概率事件发生了，拒绝原假设 H0
7. 假设检验问题，可以简化为如何计算 P值
	1. 在正态分布时，P值和 t 值有一个对应关系，求 P值，可以转化为求检验统计量 t值
	2. 对于双总体，方差未知的抽样问题
		1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003140050.png)

## 3.4.3 第一类错误、第二类错误和功效

1. 第一类错误，小概率事件发生了，拒绝原假设H0，接受 H1 出错，即为第一类错误
2. 第二类错误，小概率事件未发生，没有拒绝假设 H0，而实际 H0是错的，即第二类错误
3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003140617.png)
4. AB 实验中，原假设H0，一般是假设实验组和对照组无差异，也就是实验没效果
	1. 第一类错误是，虽然实验没有效果，但被判断为有效果
	2. 第二类错误是，虽然实验有效果，但被判断为无效果
	3. 一般来说，第一类错误的危害更大，要重点控制发生的概率
	4. 第二类错误，不会直接对产品和用户造成损失，但对于公司而言，进行任何一项实验的开发都是有成本的，如果第二类错误发生的概率过高，会导致团队的成绩无法被客观证实，提升产品效果的策略无法上线，错失产品发展的机会
5. 为控制第二类错误，引入概念 —— 功效 power
	1. 指当 H0 不成立时，做出拒绝 H0的结论，正确的概率
	2. 结合 P值，基本判断流程
		1.  P < α，拒绝原假设 H0，认为策略有效
		2.  P >= α，不能拒绝原假设 H0，也不能接受 H1，此时不能说策略有效或无效
			1. 此时进一步观察功效
				1. 功效 > 80%
					1. 说明第二类错误概率也很低，即策略有效却被判断为无效的概率很低，此时策略大概率是无效的
				2. 功效 < 80%
					1. 此时策略有效却被判断为无效的概率还是比较大的
	3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003142151.png)

## 3.4.4 如何计算功效

1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003142719.png)
2. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003142840.png)
	1. *未彻底弄懂，需多参考资料*

# 3.5 非参数检验

1. 非参数的方阿飞，对总体概率没有分布形式的要求，不对模型做任何参数假设，完全是基于数据模拟的方法
2. 常用的非参数检验方法
	1. bootstrap
		1. 进行有放回的采样
	2. jackknife
		1. 进行无放回的采样
		2. 实际应用中，应用更多

# 3.6 方差估计问题

1. 在区间估计、假设检验中，均值和方差是置信区间、P值等指标计算的核心基石，而且减少方差是提升实验检测精度的主要手段之一
2. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003144543.png)


## 3.6.1 变化绝对差和相对差的方差估计

1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231003144240.png)
	1. 在报告实验结果时，一般更多地使用相对差异，而不是绝对差异

## 3.6.2 比率类指标的方差估计

1. 关键假设：样本Y1、Y2、Y3等，需满足独立分布假设，或者至少不相关
2. 要正确估计方差，可以将比率指标写为“用户级别指标的平均值”的比率
3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231004025035.png)

## 3.6.3 其他指标的方差估计

1. 当涉及基于时间序列的指标时，通常使用分位数，而不是平均值来衡量
2. 可以用密度估计和 delta 方法的组合
3. 可以使用 bootstrap 或 jackknife 方法，模拟随机抽样获得方差估计，从而不需要预设指标的任何参数，也不需要满足正态分布
## 3.6.4 异常点对方差估计的影响

1. 异常值对均值和方差都有很大影响，在统计测试中，对方差的影响往往大于对均值的影响
2. 在估计方差时，去除异常值是至关重要的
3. 方法：简单地将观测值限制在一个合理的阈值内

# 3.7 多重测试问题

## 3.7.1 什么是多重测试问题

1. 通过假设检验的方式来判断实验结果，每一次判断都存在一定的概率判断错误。多重测试问题的本质是，如果判断的次数变多，这个错误的概率就可能增加
2. 随着实验的次数增加，实验结论容易导致假阳性。
3. 在 AB实验 中，我们首先要尽量避免进行多重测试，如果多重测试无法避免，就需要对这个错误的概率进行控制
## 3.7.2 如何避免多重测试

1. 主要来源：
	1. 多次重复进行相同的实验
	2. 多次进行相同比对
		1. 一个实验组有多个对照组进行多次比对
		2. 一个对照组有多个实验组进行多次比对
		3. 多个实验组与多个对照组之间进行多多比对
		4. 实验者出于各种考虑，开设了多个相同的实验组，实验结果发现有一个实验组有显著效果，其余实验组没有显著效果，很容易采用有效果的实验组数据作为实验决策数据，这非常容易导致实验结论的假阳性
	3. 实验进行过程中多次查看实验结果，即常说的实验偷窥，也容易导致多重测试
	4. 同一个实验有多个指标的情况
		1. 有多个实验指标的时候，容易出现假阳性，错误发生的数量会增加
2. 措施与规范
	1. 构建实验指标体系的时候，核心试验指标的设置和选择要尽量少
	2. 实验过程中不要多次查看实验结果，不以实验过程的数据作为实验结果的判断依据
	3. 在不可避免要进行多重测试的时候，选择恰当的统计方法来处理多重比较的问题，控制第一类错误的发生率

## 3.7.3 如何控制多重测试问题

1. 控制总体第一类错误，最常用的是 Bonferroni 法
	1. 基本原理：若进行 n 此检验，显著性水平（检验水准）α 应校正为 `α/n`，或将 P值乘以 n 后再与 α 比较
	2. 方法较保守，也很严苛

### 1 Fallback 法

1. 信息流实验
	1. 结果指标
		1. 用户人均使用时长
		2. 次日留存率
	2. 步骤：
		1. 进行人均使用时长的组间差异检验，定义在 P值 <= 0.01 的水平。
			1. 如果人均时长指标差异显著，则确证次日留存率获益的概率可能会增加
		2. 做如下考虑：
			1. 如果第一步中人均时长差异显著，那么次日留存率的分析将设定在更高的水平，P值 <= 0.05；
			2. 否则，第二步的分析将设定 P值 <= 0.04
	3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231004031529.png)

### 2 Holm 法

1. Holm 法显示了将 α 平均分配检验策略
2. 步骤
	1. 第一步：指标1 的显著性水平建立在 P值 <= 0.025 的水平
	2. 第二步：如果指标1效果显著，那么指标2的显著水平为 P值 <= 0.05；如果指标1的效果不显著，那么指标2的显著性水平为 P值 <= 0.025
	3. 第三步：如果指标1效果不显著，那么可以对指标1 再次检查
		1. 如果第二步指标2的效果显著，并且指标1的 P值 <= 0.05，那么指标1的显著效果被确证
3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231004032352.png)


---

1. 简单经验法则
	1. 将所有指标分为3组：
		1. 一阶指标，那些预计会受到实验影响的指标
		2. 二阶指标，那些可能会受到影响的指标
		3. 三阶指标，那些不太可能受到影响的指标
	2. 对每一组应用分级显著性水平
2. 这些经验基于 贝叶斯解释，在进行实验之前，你相信H0是正确的吗？信念越坚定，应该使用的重要性级别就越低

---