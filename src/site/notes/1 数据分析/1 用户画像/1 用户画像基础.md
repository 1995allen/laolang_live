---
{"dg-publish":true,"permalink":"/1 数据分析/1 用户画像/1 用户画像基础/","dgPassFrontmatter":true,"noteIcon":"","created":"2023-10-04T04:06:48.513+08:00","updated":"2023-10-06T17:01:19.802+08:00"}
---

# 1.1 用户画像是什么？

> 要做精细化运营，首先要建立本企业的用户画像

## 1.1.1 画像简介

1. 用户画像
	1. 即用户信息标签化，通过收集用户的社会属性、消费习惯、偏好特征等各个维度的数据，进而对用户或产品特征属性进行刻画，并对这些特征进行分析、统计，挖掘潜在价值信息，从而抽象出用户的信息全貌
	2. 企业营业大数据的根基，定向广告投放与个性化推荐的前置条件，为数据驱动运营奠定了基础
	3. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006151322.png)
2. 从基础设施建设到应用层面，主要有数据平台搭建与运维管理、数据仓库开发、上层应用的统计分析、报表生成及可视化、用户画像建模、个性化推荐与精准营销等应用方向
3. 数据应用体系的层级划分
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006151608.png)
## 1.1.2 标签类型

1. 用户画像建模其实就是对用户“打标签”，从用户打标签的方式来看，一般有3类
	1. 统计类标签
		1. 最常见的，如性别、年龄、城市、星座等
	2. 规则类标签
		1. 基于用户行为及确定的规则产生
	3. 机器学习挖掘类标签
		1. 通过机器学习挖掘产生，用于对用户的某些属性或某些行为进行预测判断
2. 机器学习标签开发周期长，成本高，开发所占比例小，统计类标签应用较多

# 1.2 数据架构

1. 工程化方案中，系统依赖的基础设施包括：Spark、Hive、HBase、Airflow、MySQL、Redis、Elasticsearch
2. 系统主体包括：Spark Streaming、ETL、产品端
3. 用户画像数仓架构图（示例）
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006154402.png)
	2. 下方虚线框中，为常见的数据仓库 ETL 加工流程，将每日的业务数据、日志数据、埋点数据等经过 ETL 过程，加工到数据仓库对应的 ODS层、DW层、DM层
	3. 中间虚线框即为用户画像建模的主要环节，基于数据仓库ODS层、DW层、DM层中与用户相关数据进行二次建模加工，在 ETL 过程中将用户标签计算结果写入 Hive
	4. 后续需要进一步将数据同步到 MySQL、HBase、Elasticsearch 等数据中
		1. Hive：存储用户标签计算结果、用户人群计算结果、用户特征库计算结果
		2. MySQL：存储表情元数据，监控相关数据，导出到业务系统的数据
		3. HBase：存储线上接口实时调用类数据
		4. Elasticsearch：支持海量数据的实时查询分析，用于存储用户人群计算、用户群透视分析所需的用户标签数据
4. 用户标签数据
	1. 在 Hive加工完成后，部分通过 Sqoop 同步到 MySQL 数据库，用于 BI 报表展示、多维度透视分析、圈人服务数据
	2. 另一部分同步到 HBase数据库用于产品的线上个性化推荐
# 1.3 主要覆盖模块

1. 搭建一套用户还行方案，需考虑 8个模块的建设
	1. 用户画像基础
		1. 需了解、明确用户画像是什么，包含哪些模块，数据仓库架构是什么样的，开发流程、表结构设计、ETL设计等
		2. 用户画像是什么
			1. 画像简介
			2. 标签类型
		3. 数据架构
		4. 开发流程
		5. 常见表结构设计
			1. 日增量数据
			2. 日全量数据
	2. 数据指标体系
		1. 根据业务线梳理，包括用户属性、用户行为、用户消费、风险控制等维度的指标体系
		2. 用户属性维度标签
			1. 常见用户属性
			2. 用户性别
		3. 用户行为维度标签
		4. 用户消费维度标签
		5. 风险控制维度标签
		6. 标签命名方式
	3. 标签数据存储
		1. 标签相关数据可存储在 Hive、MySQL、HBase、Elasticsearch数据库中，对应不同的应用场景
		2. Hive 存储
			1. 分区插入数据
			2. 标签 ID-Maping
		3. MySQL存储
			1. 元数据管理
			2. 标签量级监控
			3. 结果集存储
		4. HBase存储
		5. ES存储
	4. 标签数据开发
		1. ==重点模块==，包含统计类、规则类、挖掘类、流式计算类标签的开发，以及人群计算功能的开发，打通画像数据和各业务系统之间的通路，提供接口服务等开发内容
		2. 统计类标签开发
		3. 规则类标签开发
			1. 数据调研
			2. 确定业务规则
		4. 挖掘类标签开发
		5. 流式计算标签开发
			1. 读取 Kafka 数据
			2. 标签开发
			3. 上线工程化
		6. 打通数据服务层
	5. 开发性能调优
		1. 标签加工、人群计算等脚本上线调度后，需对开发的脚本进行迭代重构、调优
		2. 数据倾斜调优
		3. Spark 读取小文件调优
		4. 使用 Spark 缓存
		5. 减少 shuffle 类算子
		6. ID-Maping 映射
		7. 开发中间表
	6. 作业流程调度
		1. 标签加工、人群计算、同步数据到业务系统、数据监控预警等脚本开发完成后，需调度工具把整套流程调度起来
			1. （本书）讲解了 Airflow 开源 ETL 工具在调度画像相关任务脚本上的应用
		2. Crontab 命令调度
		3. Airflow 工作平台
			4. Aifflow 服务构成
			5. 主要功能模块
			6. 工作流调度
			7. 常用命令
		4. 标签数据监控预警
		5. ETL 异常排查
	7. 用户画像产品化
		1. 为更好服务业务，需以产品化的形态应用在业务上
			1. 主要模块
				1. 标签视图
				2. 用户标签查询
				3. 用户分群
				4. 透视分析等
		2. 标签视图查询
		3. 标签编辑管理
		4. 自定义配置查询
		5. 多维透视分析
		6. 目标人群固定
	8. 用户画像应用
		1. 包括用户特征分析、短信、邮件、站内信、Push消息的精准推送、客服针对用户的不同话术
			1. 用户精细化运营
		2. 经营分析
			1. 商品分析
			2. 用户分析
			3. 流量分析
		3. 精装营销
			1. 短信、邮件管理
			2. ROI 效果分析
		4. 个性化推荐与服务
			1. Push 消息
			2. 相关商品推荐
			3. 用户个性化服务

# 1.4 开发阶段流程

## 1.4.1 开发上线流程

![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006161349.png)

1. 第一阶段：目标解读
	1. 明确用户画像服务于企业的对象，再根据业务方需求，明确未来产品建设目标和用户画像分析之后的预期效果
2. 第二阶段：任务分解与需求调研
	1. 针对服务对象的需求侧重带你，结合产品现有业务体系和“数据字典”规约实体和标签之间的关联关系，明确分析维度
3. 第三阶段：需求场景讨论与明确
	1. 数据运营人员需要根据与需求方的沟通结果，输出产品用户画像需求文档
		1. 文档中需明确应用场景、最终开发出的标签内容与应用方式，并与需求方反复确认
4. 第四阶段：应用场景与数据口径确认
	1. 需结合业务与数据仓库中已有的相关表，明确与各业务场景相关的数据口径
	2. 数据运营方，需输出产品用户画像开发文档（面向数据运营团队内部）
		1. 明确应用场景
		2. 标签开发的模型
		3. 涉及的数据库与表
		4. 应用实施流程
5. 第五阶段：特征选取与模型数据落表
	1. 数据分析挖掘人员根据明确的需求场景进行业务建模，写好 HQL 逻辑，将相应的模型逻辑写入临时表中，并校验
6. 第六阶段：线下模型数据验收与测试
	1. 设置定时调度任务，定期增量更新数据
	2. 数据运营人员需验收数仓假工的HQL 逻辑是否符合需求，根据业务需求抽取表中数据查看其是否在合理范围内
7. 第七阶段：线上模型发布与效果追踪
	1. 通过 git 进行版本管理，部署上线
	2. 持续追踪标签应用效果及业务方反馈，调整优化模型及相关权重配置

## 1.4.2 各阶段关键产出

1. 标签开发
	1. 性别标签开发
	2. 会员标签开发
	3. 活跃度标签开发
	4. RFM标签开发等
2. ETL调度开发
	1. 任务依赖关系梳理
	2. 监控脚本开发
	3. 调度脚本开发
	4. 上线调度系统
3. 打通服务层接口
	1. push 系统业务对接沟通
	2. 外呼系统业务对接沟通
	3. 广告系统业务对接沟通等
4. 画像产品化
	1. 产品经理与业务人员技术开发对接沟通
	2. Java Web端开发
	3. 产品上线
5. 开发调优
	1. 标签脚本、调度脚本的重构优化
6. 面向业务方推广应用
	1. 写画像使用稳定
	2. 提供业务支持

# 1.5 画像应用的落地

1. 数据分析人员
	1. 可能关注用户画像开发了哪些表、哪些字段以及字段的口径定义
2. 运营、客服
	1. 可能关注用户标签定义的口径，如何在 web端使用用户画像产品进行分析、圈定用户进行定向营销
	2. 以及数据的准确性和及时性

# 1.6 某用户画像案例

本案例，基于 Spark 计算引擎，涉及语言包括 HiveQL、Python、Scala、Shell等

## 1.6.1 案例背景介绍

1. 图书电商网站，千万网购用户群体，100w+图书
2. 用户可以
	1. 浏览
	2. 搜索
	3. 收藏
	4. 下单
	5. 购买等
3. 需解决的问题
	1. 企业产品线扩张，信息资源过载的背景下，兼顾自身商业目标的同时更好满足消费者需求，个性化购物体验，提高用户的点击转化率
	2. 建立用户流失预警机制，及时识别并采取措施挽回

## 1.6.2 相关元数据

1. 本案例数据可分为：业务类数据、用户行为数据
2. 用户信息表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163620.png)

3. 商品订单白哦
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163642.png)

4. 埋点日志表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163701.png)
	2. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163715.png)
5. 访问日志表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163816.png)

6. 商品评论表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163950.png)

7. 搜索日志表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163851.png)

8. 用户收藏表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163915.png)

9. 购物车信息表
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006163924.png)



## 1.6.3 画像表结构设计

1. 需考虑存储哪些信息、如何存储（数据分区）、如何应用（如何抽取标签）这3个方面的问题
2. 主要有两种设计思路
	1. 每日全量数据包的表结构
		1. 日期分区中记录着截止到今天的全量1用户数据
		2. 优势是便于查询，但不便于探查更细粒度的用户行为
	2. 每日增量数据的表结构
		1. 可视为 ODS层的用户行为画像，需基于该增量数据做进一步的建模加工

### 1. 日全量数据

```SQL
CREATE TABLE `dw.userprofile_attritube_all`(
	`userid` sting COMMENT 'userid',
	`labelweight` sting COMMENT '标签权重',)
COMMENT 'userid 用户画像数据'
PARTTIONED BY (`date_date` string COMMENT '数据日期'， `theme` string COMMENT '二级主题', 'labelid' sting COMMENT '标签id')
```


```sql
-- 插入主题类型为 会员 的标签，20190101 的全量数据
insert overwrite table dw.userprofile_attritube_all partition(date_date = '20190101',theme='member', labelid='ATTRITUBE_U_05_001')
```

### 2 日增量设计

1. 每天的日期分区中插入当天业务运行产生的数据，进行查询时通过限制查询的日期范围，可以找出特定时间范围内被打上特定标签的用户

```SQL
CREATE TABLE dw.userprofile_act_feature_append(
	labelid STRING COMMENT '标签id',
	cookieid STRING COMMENT '用户id',
	act_cnt int COMMENT '行为次数',
	tag_type_id int COMMENT '标签类型编码',
	act_type_id int COMMENT '行为类型编码',)
comment '用户画像-用户行为标签表'
PARTITIONED BY (data_data STRING COMMENT '数据日期')
```

### 3 关于宽表设计

1. 用户属性宽表设计，主要记录用户基本属性信息
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006165642.png)
	2. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006165704.png)
2. 用户日活跃宽表设计
	1. ![image.png](https://xunhuanke-1309879741.cos.ap-nanjing.myqcloud.com/blog/20231006165738.png)

# 1.7 定性类画像

1. 定性类画像多见于用户研究等运营类岗位，通过电话调研、网络调研问卷、当面深入访谈、网上第三方权威数据等方式收集用户信息，帮助理解用户
2. 根据回收的调研问卷，可结合统计数据进一步分析用户画像特征

# 1.8 小结

1. 用户画像基础知识
	1. 简介
	2. 标签类型
	3. 数据架构
	4. 覆盖模块
	5. 开发过程中各阶段的关键产出
2. 画像系统的概貌，初步了解如何设计画像系统、开发周期、画像的应用方式